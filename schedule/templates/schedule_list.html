{% extends "base.html" %}
{% load static %}

{% block meta %}
<title>Doctor Schedules</title>
{% endblock meta %}

{% block navbar %}
{% include "components/navbar.html" with is_logged_in=True user_role="caregiver" %}
{% endblock navbar %}

{% block content %}

<body class="min-h-screen flex flex-col">
    <div class="flex-grow container mx-auto p-4 md:p-6">
        <!-- Banner -->
        <div class="welcome-banner p-6 md:p-8 mb-6 flex items-center">
            <div class="text-white relative">
                <div class="absolute -left-10 -top-6">
                    <i class="fas fa-calendar-alt text-white text-opacity-10 text-7xl"></i>
                </div>
                <h4 class="text-white md:text-xl font-header font-bold mb-1">Doctor Schedules</h4>
                <p class="text-sm opacity-90">View and manage your availability</p>
            </div>
            <div class="hidden md:flex ml-auto">
                <a href="{% url 'schedule_create' caregiver_id=caregiver_id %}"
                    class="bg-white text-primary px-4 py-2 rounded-full font-medium flex items-center hover:bg-opacity-90 transition">
                    <i class="fas fa-plus mr-2"></i>
                    Create Schedule
                </a>
            </div>
        </div>

        <!-- Schedules Table -->
        <div class="card bg-white p-5">
            {% if schedules %}
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Day</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Time</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for schedule in schedules %}
                        <tr>
                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{ schedule.date }}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{ schedule.day }}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{ schedule.startTime }} - {{ schedule.endTime }}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <span
                                    class="status-badge status-{{ schedule.status|lower }} px-2 py-1 text-xs font-medium rounded-full">
                                    {{ schedule.status }}
                                </span>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <form method="post"
                                    action="{% url 'schedule_delete' caregiver_id=caregiver_id schedule_id=schedule.id %}"
                                    class="inline"
                                    onsubmit="return confirm('Are you sure you want to delete this schedule?');">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-900">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-10">
                <div class="text-gray-400 mb-3">
                    <i class="fas fa-calendar-times text-5xl"></i>
                </div>
                <h4 class="text-lg font-medium text-gray-500 mb-2">No Schedules Found</h4>
                <p class="text-gray-400 mb-4">You haven't created any schedules yet or no schedules match your filters
                </p>
                <a href="{% url 'schedule_create' caregiver_id=caregiver_id %}"
                    class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-80">
                    <i class="fas fa-plus mr-2"></i>
                    Create New Schedule
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Status badge colors - Updated to match Java enum values
            document.querySelectorAll('.status-badge').forEach(badge => {
                const status = badge.classList[1].split('-')[1]; // Gets status from 'status-available' etc
                switch (status) {
                    case 'available':
                        badge.classList.add('bg-green-100', 'text-green-800');
                        break;
                    case 'unavailable':
                        badge.classList.add('bg-red-100', 'text-red-800');
                        break;
                    case 'inactive':
                        badge.classList.add('bg-gray-100', 'text-gray-800');
                        break;
                    default:
                        badge.classList.add('bg-gray-100', 'text-gray-800');
                }
            });
        });
    </script>
</body>
{% endblock content %}